name: Standalone Dist

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - name: Install dependencies
        run: bun install
      - name: Build
        run: VITE_STANDALONE_SECRET=true bun run build --base ./
      - name: Cleanup Standalone Dist
        run: |
          cd dist
          # Delete unwanted images from public root
          rm -f Example.png T1.png T2.png T3.png template.png profile-photo.png reel-bg.png
          # Delete CNAME
          rm -f CNAME
          # Delete unnecessary fonts, keeping only what's required for Secret page
          if [ -d "fonts" ]; then
            find fonts/ -type f ! -name 'SolaimanLipi-Regular.ttf' ! -name 'Cambria.ttf' ! -name 'cambriab.ttf' -delete
          fi
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: standalone-webapp
          path: dist/
